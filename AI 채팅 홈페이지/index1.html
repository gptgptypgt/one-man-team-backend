<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PTU 데모 v2</title>
  <link rel="stylesheet" href="style1.css" />
</head>
<body>
  <!-- 헤더 -->
  <header class="site-header">
    <div class="wrap">
      <a class="brand" href="http://43.200.39.240/">PTU</a>
      <form class="top-search" onsubmit="return false;">
        <input type="search" placeholder="검색어를 입력하세요" />
        <button>검색</button>
      </form>
      <nav class="top-icons">
        <a href="#" aria-label="login">로그인</a>
        <a href="#" aria-label="cart">🛒</a>
        <a href="#" aria-label="favorite">⭐</a>
      </nav>
    </div>
    <nav class="tabs">
      <div class="wrap">
        <a href="..AI 채팅 홈페이지/index1.html">AI견적</a>
        <a href="..기타기기/index3.html">기타기기</a>
        <a href="..노트북/index2.html">노트북</a>
        <a href="#">FAQ</a>
        <a href="..이벤트/index5.html">이벤트</a>
      </div>
    </nav>
  </header>

  <!-- 배너 -->
  <section class="banner">
    <div class="wrap">정보통신학과 파이팅 💪</div>
  </section>

  <!-- 히어로 영역 -->
  <section class="hero">
    <div class="wrap hero-inner">
      <h1 class="hero-title">AI <span> 견적을</span> 만나보세요</h1>
      <p class="hero-sub">질문이 구체적일수록 더 나은 답변을 얻을 수 있습니다</p>

      <!-- 질문 입력 -->
      <form id="askForm" class="ask" onsubmit="return false;">
        <input id="askInput" type="text" placeholder="무엇이든 물어보세요" aria-label="질문 입력" />
        <button id="askSend" type="submit" aria-label="전송">↑</button>
      </form>
    </div>
  </section>

  <!-- ▼ 답변 출력 영역 -->
  <section class="answer">
    <div class="wrap">
      <div id="chatLog" class="chat-log" aria-live="polite"></div>
    </div>
  </section>

  <script>
    // --- 간단한 프론트 로직 ---
    const form = document.getElementById('askForm');
    const input = document.getElementById('askInput');
    const log   = document.getElementById('chatLog');

    function appendMsg(text, who = 'bot') {
      const row = document.createElement('div');
      row.className = `msg ${who}`;
      row.innerHTML = `<div class="bubble">${text}</div>`;
      log.appendChild(row);
      log.scrollTop = log.scrollHeight;
    }

    function appendTyping() {
      const row = document.createElement('div');
      row.className = 'msg bot typing';
      row.innerHTML = `<div class="bubble"><span class="dot"></span><span class="dot"></span><span class="dot"></span></div>`;
      log.appendChild(row);
      log.scrollTop = log.scrollHeight;
      return row; // 제거할 때 쓰려고 반환
    }

    async function ask(text) {
      // 타이핑 표시
      const typingEl = appendTyping();

      try {
        // 백엔드가 있으면 이 부분만 그대로 쓰면 됨
        const res = await fetch('/api/ask', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ question: text })
        });

        let answerText;
        if (res.ok) {
          const data = await res.json();
          answerText = data.answer || '응답이 없어요.';
        } else {
          // 데모 응답 (백엔드 미구현 시)
          answerText = '데모 응답: 백엔드가 아직 연결되지 않았습니다.';
        }

        typingEl.remove();
        appendMsg(answerText, 'bot');
      } catch (e) {
        typingEl.remove();
        appendMsg('네트워크 오류가 발생했어요. 잠시 후 다시 시도해주세요.', 'bot');
      }
    }

    form.addEventListener('submit', () => {
      const text = input.value.trim();
      if (!text) return;

      appendMsg(text, 'user');  // 사용자 메시지 표시
      input.value = '';
      ask(text);                // 서버로 요청 (또는 데모 응답)
    });
  </script>
</body>
</html>
