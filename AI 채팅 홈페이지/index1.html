<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PTU ë°ëª¨ v2</title>
  <link rel="stylesheet" href="style1.css" />
</head>
<body>
  <!-- í—¤ë” -->
  <header class="site-header">
    <div class="wrap">
      <a class="brand" href="http://43.200.39.240/">PTU</a>
      <form class="top-search" onsubmit="return false;">
        <input type="search" placeholder="ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”" />
        <button>ê²€ìƒ‰</button>
      </form>
      <nav class="top-icons">
        <a href="#" aria-label="login">ë¡œê·¸ì¸</a>
        <a href="#" aria-label="cart">ğŸ›’</a>
        <a href="#" aria-label="favorite">â­</a>
      </nav>
    </div>
    <nav class="tabs">
      <div class="wrap">
        <a href="..AI ì±„íŒ… í™ˆí˜ì´ì§€/index1.html">AIê²¬ì </a>
        <a href="..ê¸°íƒ€ê¸°ê¸°/index3.html">ê¸°íƒ€ê¸°ê¸°</a>
        <a href="..ë…¸íŠ¸ë¶/index2.html">ë…¸íŠ¸ë¶</a>
        <a href="#">FAQ</a>
        <a href="..ì´ë²¤íŠ¸/index5.html">ì´ë²¤íŠ¸</a>
      </div>
    </nav>
  </header>

  <!-- ë°°ë„ˆ -->
  <section class="banner">
    <div class="wrap">ì •ë³´í†µì‹ í•™ê³¼ íŒŒì´íŒ… ğŸ’ª</div>
  </section>

  <!-- íˆì–´ë¡œ ì˜ì—­ -->
  <section class="hero">
    <div class="wrap hero-inner">
      <h1 class="hero-title">AI <span> ê²¬ì ì„</span> ë§Œë‚˜ë³´ì„¸ìš”</h1>
      <p class="hero-sub">ì§ˆë¬¸ì´ êµ¬ì²´ì ì¼ìˆ˜ë¡ ë” ë‚˜ì€ ë‹µë³€ì„ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤</p>

      <!-- ì§ˆë¬¸ ì…ë ¥ -->
      <form id="askForm" class="ask" onsubmit="return false;">
        <input id="askInput" type="text" placeholder="ë¬´ì—‡ì´ë“  ë¬¼ì–´ë³´ì„¸ìš”" aria-label="ì§ˆë¬¸ ì…ë ¥" />
        <button id="askSend" type="submit" aria-label="ì „ì†¡">â†‘</button>
      </form>
    </div>
  </section>

  <!-- â–¼ ë‹µë³€ ì¶œë ¥ ì˜ì—­ -->
  <section class="answer">
    <div class="wrap">
      <div id="chatLog" class="chat-log" aria-live="polite"></div>
    </div>
  </section>

  <script>
    // --- ê°„ë‹¨í•œ í”„ë¡ íŠ¸ ë¡œì§ ---
    const form = document.getElementById('askForm');
    const input = document.getElementById('askInput');
    const log   = document.getElementById('chatLog');

    function appendMsg(text, who = 'bot') {
      const row = document.createElement('div');
      row.className = `msg ${who}`;
      row.innerHTML = `<div class="bubble">${text}</div>`;
      log.appendChild(row);
      log.scrollTop = log.scrollHeight;
    }

    function appendTyping() {
      const row = document.createElement('div');
      row.className = 'msg bot typing';
      row.innerHTML = `<div class="bubble"><span class="dot"></span><span class="dot"></span><span class="dot"></span></div>`;
      log.appendChild(row);
      log.scrollTop = log.scrollHeight;
      return row; // ì œê±°í•  ë•Œ ì“°ë ¤ê³  ë°˜í™˜
    }

    async function ask(text) {
      // íƒ€ì´í•‘ í‘œì‹œ
      const typingEl = appendTyping();

      try {
        // ë°±ì—”ë“œê°€ ìˆìœ¼ë©´ ì´ ë¶€ë¶„ë§Œ ê·¸ëŒ€ë¡œ ì“°ë©´ ë¨
        const res = await fetch('/api/ask', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ question: text })
        });

        let answerText;
        if (res.ok) {
          const data = await res.json();
          answerText = data.answer || 'ì‘ë‹µì´ ì—†ì–´ìš”.';
        } else {
          // ë°ëª¨ ì‘ë‹µ (ë°±ì—”ë“œ ë¯¸êµ¬í˜„ ì‹œ)
          answerText = 'ë°ëª¨ ì‘ë‹µ: ë°±ì—”ë“œê°€ ì•„ì§ ì—°ê²°ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.';
        }

        typingEl.remove();
        appendMsg(answerText, 'bot');
      } catch (e) {
        typingEl.remove();
        appendMsg('ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆì–´ìš”. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.', 'bot');
      }
    }

    form.addEventListener('submit', () => {
      const text = input.value.trim();
      if (!text) return;

      appendMsg(text, 'user');  // ì‚¬ìš©ì ë©”ì‹œì§€ í‘œì‹œ
      input.value = '';
      ask(text);                // ì„œë²„ë¡œ ìš”ì²­ (ë˜ëŠ” ë°ëª¨ ì‘ë‹µ)
    });
  </script>
</body>
</html>
